{% form_theme form 'ZiiwebEcommerceBundle:Product:aux_form_theme.html.twig' %}
{{ form_widget(form) }}
<script type="text/javascript" src="/bundles/ziiwebecommerce/js/accounting.js"></script>
<script type="text/javascript">

    //add element to collection form
    $('.add-product').on('click', function(event) {
	event.preventDefault();
	var prototype = $(this).prev().data('prototype');
        var index = $(this).prev().children().length;
        prototype = prototype.replace(/\__name__/g, index);
	$(this).prev().append($.parseHTML(prototype));
    });

    $('.add-image').on('click', function(event) {
	event.preventDefault();

	var prototype = $(this).prev().data('prototype');
        var index = $(this).prev().children().length;
        prototype = prototype.replace(/\__name__/g, index);
	$(this).prev().append($.parseHTML(prototype));
    });

    //delete a product version
    $(document).on('click', '.delete-product', function(event) {
        event.preventDefault();
        $(this).prev().remove();
        $(this).remove();
    })

    $(document).on('click', '.delete-image', function(event) {
        event.preventDefault();
        $(this).parent().parent().remove();
    });

    $('.price').on('change key paste keyup', function() {
      var price_with_dots =  parseFloat($(this).val().replace(',', '.'));
      var tax_rate = {{ constant('Ziiweb\\EcommerceBundle\\Entity\\TaxRates::VAT_RATE') + 1 }};
      var price_plus_taxes =  price_with_dots * tax_rate; 
      $('.price_plus_taxes').val(accounting.formatNumber(price_plus_taxes, 2, '', ',')); 
    })

    $('.price_plus_taxes').on('change key paste keyup', function() {
      var price_with_dots =  parseFloat($(this).val().replace(',', '.'));
      var tax_rate = {{ constant('Ziiweb\\EcommerceBundle\\Entity\\TaxRates::VAT_RATE') + 1 }};
      var price =  price_with_dots * tax_rate; 
      $('.price').val(accounting.formatNumber(price, 2, '', ',')); 
    })
</script>
